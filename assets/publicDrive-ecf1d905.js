import{A as m,a as p}from"./index-4ea88b9c.js";const u=m;let d=!1,a=null;const f=s=>d?Promise.resolve():a||(a=new Promise((t,e)=>{let r=0;const i=()=>{window.gapi?window.gapi.load("client",async()=>{try{await window.gapi.client.init({apiKey:s,discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]}),d=!0,t()}catch(o){console.error("Failed to initialize GAPI client:",o),e(o)}}):(r++,r>20?e(new Error("Google API Script not loaded (timeout)")):setTimeout(i,500))};i()}),a),g=async(s,t)=>{try{await f(s);const e=window.gapi.client.getToken();e&&window.gapi.client.setToken(null);try{return(await window.gapi.client.drive.files.list({q:`'${t}' in parents and mimeType = 'application/json' and trashed = false`,fields:"files(id, name, createdTime, modifiedTime)"})).result.files||[]}finally{e&&window.gapi.client.setToken(e)}}catch(e){return console.error("Error listing public stacks:",e),[]}},y=async(s,t,e=null,r=!1)=>{try{const i=e?`&token=${encodeURIComponent(e)}`:"",o=await fetch(`${u}?action=read&id=${t}&key=${p}${i}&t=${Date.now()}`);if(o.ok){const n=await o.json();if(n&&!n.error)return n;n!=null&&n.error&&console.error("Proxy returned error:",n.error)}}catch(i){console.error("Critical: Proxy fetch failed. This may be due to an AdBlocker or Backend configuration.",i)}return null},k=async(s,t,e=null)=>{try{await f(s);const i=(await window.gapi.client.drive.files.list({q:`'${t}' in parents and name = 'public_index.json' and trashed = false`,fields:"files(id, name)"})).result.files;if(i&&i.length>0){const o=i[0].id,n=e?`&token=${encodeURIComponent(e)}`:"",w=`${u}?action=read&id=${o}&key=${p}${n}&t=${Date.now()}`,c=await fetch(w);if(c.ok){const l=await c.json();return l&&!l.error?l:null}return null}return null}catch(r){return console.error("Error fetching public index:",r),null}};export{u as APPS_SCRIPT_URL,y as getPublicFileContent,k as getPublicIndex,g as listPublicStacks};
