import{c as V,r as p,A as ae,j as e,C as Xe,s as P,T as Q,N as W,P as _,R as Ye,a as Ze,X as ee,b as $e,v as Ge,_ as Je,d as re,e as et,f as tt}from"./index-9a3e1dd9.js";import{D as nt,I as it,d as ot,u as st}from"./ImageViewer-8355e0fd.js";import{C as lt}from"./copy-63b62261.js";import{M as Ee}from"./mic-3996f2bc.js";const ce=V("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),at=V("Merge",[["path",{d:"m8 6 4-4 4 4",key:"ybng9g"}],["path",{d:"M12 2v10.3a4 4 0 0 1-1.172 2.872L4 22",key:"1hyw0i"}],["path",{d:"m20 22-5-5",key:"1m27yz"}]]),rt=V("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),ct=V("Split",[["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M8 3H3v5",key:"15dfkv"}],["path",{d:"M12 22v-8.3a4 4 0 0 0-1.172-2.872L3 3",key:"1qrqzj"}],["path",{d:"m15 9 6-6",key:"ko1vev"}]]),dt=V("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),te=({value:l,onChange:n,placeholder:E,style:f={},...k})=>{const R=p.useRef(null),c=g=>{g&&(g.style.height="auto",g.style.height=`${g.scrollHeight}px`)};return p.useEffect(()=>{c(R.current)},[l]),e.jsx("textarea",{ref:R,className:"neo-input",placeholder:E,value:l,onChange:g=>{n(g),c(g.target)},style:{...f,overflow:"hidden",resize:"none",minHeight:"40px",display:"block"},...k})},Fe=({card:l,index:n,totalCards:E,onUpdate:f,onRemove:k,onMove:R,recording:c,startRecording:g,stopRecording:A,cancelRecording:j,recordingTime:K,handleFileUpload:h,handleOptionChange:w,setViewingImage:H,showSplitUI:D,selectedCards:T,toggleCardSelection:N})=>{var L;const q=d=>{const b=Math.floor(d/60),M=d%60;return`${b}:${M.toString().padStart(2,"0")}`};return e.jsxs("div",{className:"neo-inset",style:{padding:"1.5rem",display:"flex",flexDirection:"column",gap:"1rem",position:"relative"},children:[D&&e.jsx("div",{style:{position:"absolute",top:"10px",left:"10px",zIndex:5},children:e.jsx("input",{type:"checkbox",className:"neo-checkbox",checked:T==null?void 0:T.has(l.id),onChange:()=>N==null?void 0:N(l.id)})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"0.5rem"},children:[e.jsx("div",{style:{fontSize:"0.9rem",fontWeight:"bold",opacity:.5,display:"flex",alignItems:"center",gap:"0.5rem"},children:e.jsxs("span",{children:[l.type==="mcq"?"MCQ":"CARD"," ",n+1]})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",background:"var(--bg-color)",padding:"4px 8px",borderRadius:"8px",boxShadow:"inset 2px 2px 4px var(--shadow-dark), inset -2px -2px 4px var(--shadow-light)"},children:[e.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:"Pos:"}),e.jsx("input",{type:"number",className:"neo-input",style:{width:"40px",padding:"2px",textAlign:"center",boxShadow:"none",background:"transparent",height:"auto",fontSize:"0.9rem",fontWeight:"bold"},placeholder:"#",onBlur:d=>{d.target.value&&(R(d.target.value),d.target.value="")},onKeyDown:d=>{d.key==="Enter"&&d.target.value&&(R(d.target.value),d.target.value="")}})]}),e.jsx("button",{className:"neo-button icon-btn",style:{width:"32px",height:"32px",color:"var(--error-color)",boxShadow:"none"},onClick:k,title:"Delete Card",children:e.jsx(Q,{size:16})})]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"bold"},children:"QUESTION"}),e.jsxs("div",{style:{display:"flex",gap:"5px"},children:[c?c.id===l.id&&c.field==="question"?e.jsxs("div",{className:"neo-flat",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:10,borderRadius:"12px",display:"flex",alignItems:"center",padding:"0 1rem",gap:"1rem",background:"var(--bg-color)"},children:[e.jsx("div",{style:{width:"10px",height:"10px",background:"red",borderRadius:"50%",animation:"pulse 1s infinite"}}),e.jsxs("span",{style:{flex:1,fontWeight:"600"},children:["Recording... ",q(K)]}),e.jsx("button",{className:"neo-button icon-btn",title:"Cancel",style:{width:"32px",height:"32px"},onClick:j,children:e.jsx(ee,{size:14,color:"var(--error-color)"})}),e.jsx("button",{className:"neo-button icon-btn",title:"Stop & Save",style:{width:"32px",height:"32px"},onClick:A,children:e.jsx($e,{size:14,color:"var(--accent-color)"})})]}):null:e.jsxs("div",{style:{display:"flex",gap:"5px"},children:[e.jsx("button",{className:"neo-button icon-btn",style:{width:"32px",height:"32px",color:l.question.audio?"var(--accent-color)":"currentColor"},onClick:()=>g(l.id,"question"),children:e.jsx(Ee,{size:14})}),l.question.audio&&e.jsx("button",{className:"neo-button icon-btn",style:{width:"32px",height:"32px"},onClick:()=>f("question",{...l.question,audio:""}),children:e.jsx(Q,{size:12,color:"var(--error-color)"})})]}),e.jsxs("label",{className:"neo-button icon-btn",style:{width:"32px",height:"32px",cursor:"pointer"},children:[e.jsx(ce,{size:14,color:l.question.image?"var(--accent-color)":"currentColor"}),e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:d=>h(d,b=>f("question",{...l.question,image:b}))})]})]})]}),l.question.image&&e.jsxs("div",{style:{position:"relative",width:"100%",maxHeight:"150px"},children:[e.jsx("img",{src:l.question.image,style:{width:"100%",height:"100%",maxHeight:"150px",objectFit:"contain",borderRadius:"8px",cursor:"pointer"},onClick:()=>H(l.question.image)}),e.jsx("button",{className:"neo-button icon-btn",style:{position:"absolute",top:"5px",right:"5px",width:"24px",height:"24px"},onClick:()=>f("question",{...l.question,image:""}),children:e.jsx(ee,{size:12})})]}),e.jsx("div",{style:{position:"relative"},children:e.jsx(te,{placeholder:"The question... ",value:l.question.text,onChange:d=>f("question",{...l.question,text:P(d.target.value)}),style:{paddingRight:"30px"}})})]}),l.type==="mcq"?e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"bold"},children:"OPTIONS"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:(L=l.options)==null?void 0:L.map((d,b)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("input",{type:"radio",name:`correct-${l.id}`,checked:d.isCorrect,onChange:()=>w(d.id,"isCorrect",!0),style:{width:"18px",height:"18px",cursor:"pointer",accentColor:"var(--accent-color)"}}),e.jsx("input",{className:"neo-input",placeholder:`Option ${String.fromCharCode(65+b)}`,value:d.text,onChange:M=>w(d.id,"text",P(M.target.value)),style:{borderColor:d.isCorrect?"var(--accent-color)":"transparent",borderWidth:d.isCorrect?"2px":"1px"}})]},d.id))})]}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"bold"},children:"ANSWER"}),e.jsxs("div",{style:{display:"flex",gap:"5px"},children:[c?c.id===l.id&&c.field==="answer"?e.jsxs("div",{className:"neo-flat",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:10,borderRadius:"12px",display:"flex",alignItems:"center",padding:"0 1rem",gap:"1rem",background:"var(--bg-color)"},children:[e.jsx("div",{style:{width:"10px",height:"10px",background:"red",borderRadius:"50%",animation:"pulse 1s infinite"}}),e.jsxs("span",{style:{flex:1,fontWeight:"600"},children:["Recording... ",q(K)]}),e.jsx("button",{className:"neo-button icon-btn",title:"Cancel",style:{width:"32px",height:"32px"},onClick:j,children:e.jsx(ee,{size:14,color:"var(--error-color)"})}),e.jsx("button",{className:"neo-button icon-btn",title:"Stop & Save",style:{width:"32px",height:"32px"},onClick:A,children:e.jsx($e,{size:14,color:"var(--accent-color)"})})]}):null:e.jsxs("div",{style:{display:"flex",gap:"5px"},children:[e.jsx("button",{className:"neo-button icon-btn",style:{width:"32px",height:"32px",color:l.answer.audio?"var(--accent-color)":"currentColor"},onClick:()=>g(l.id,"answer"),children:e.jsx(Ee,{size:14})}),l.answer.audio&&e.jsx("button",{className:"neo-button icon-btn",style:{width:"32px",height:"32px"},onClick:()=>f("answer",{...l.answer,audio:""}),children:e.jsx(Q,{size:12,color:"var(--error-color)"})})]}),e.jsxs("label",{className:"neo-button icon-btn",style:{width:"32px",height:"32px",cursor:"pointer"},children:[e.jsx(ce,{size:14,color:l.answer.image?"var(--accent-color)":"currentColor"}),e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:d=>h(d,b=>f("answer",{...l.answer,image:b}))})]})]})]}),l.answer.image&&e.jsxs("div",{style:{position:"relative",width:"100%",maxHeight:"150px"},children:[e.jsx("img",{src:l.answer.image,style:{width:"100%",height:"100%",maxHeight:"150px",objectFit:"contain",borderRadius:"8px",cursor:"pointer"},onClick:()=>H(l.answer.image)}),e.jsx("button",{className:"neo-button icon-btn",style:{position:"absolute",top:"5px",right:"5px",width:"24px",height:"24px"},onClick:()=>f("answer",{...l.answer,image:""}),children:e.jsx(ee,{size:12})})]}),e.jsx(te,{placeholder:"The answer... ",value:l.answer.text,onChange:d=>f("answer",{...l.answer,text:P(d.target.value)})})]})]},l.id)},mt=({user:l,stack:n,onClose:E,onSave:f,onDuplicate:k,onDelete:R,showAlert:c,showConfirm:g,availableLabels:A,allStacks:j,activeTab:K,defaultMetadata:h})=>{const[w,H]=p.useState((n==null?void 0:n.title)||""),[D,T]=p.useState((n==null?void 0:n.titleImage)||""),[N,q]=p.useState((n==null?void 0:n.label)||"No label"),[L,d]=p.useState((n==null?void 0:n.importantNote)||""),[b,M]=p.useState(""),[u,m]=p.useState((n==null?void 0:n.cards)||[{id:Date.now(),question:{text:"",image:"",audio:""},answer:{text:"",image:"",audio:""}}]),[de,pe]=p.useState((n==null?void 0:n.standard)||(n?"":(h==null?void 0:h.standard)||"")),[xe,ue]=p.useState((n==null?void 0:n.syllabus)||(n?"":(h==null?void 0:h.syllabus)||"")),[he,me]=p.useState((n==null?void 0:n.medium)||(n?"":(h==null?void 0:h.medium)||"")),[ge,ye]=p.useState((n==null?void 0:n.subject)||(n?"":(h==null?void 0:h.subject)||"")),[fe,be]=p.useState((n==null?void 0:n.cost)||0),[x,C]=p.useState((n==null?void 0:n.sections)||[]),[O,We]=p.useState(K==="ready-made"&&(l==null?void 0:l.email)===ae),[ve,ne]=p.useState(null),je=p.useRef(null),[F,ie]=p.useState(!1),[I,X]=p.useState(new Set),[Y,we]=p.useState(!1),[Z,Pe]=p.useState(""),[$,Se]=p.useState(!1),ke=p.useRef(null),G=p.useRef(null),[Ce,J]=p.useState(null),[Ne,U]=p.useState(0),[B,oe]=p.useState(null),se=p.useRef(null),He=()=>{const t={id:Date.now(),type:"flashcard",question:{text:"",image:"",audio:""},answer:{text:"",image:"",audio:""}};if(x.length>0){const s=x.length-1,o=[...x];o[s].cards.push(t),C(o),m(o.flatMap(i=>i.cards))}else m([...u,t]);Ie()},Le=()=>{const t={id:Date.now(),type:"mcq",question:{text:"",image:"",audio:""},options:[{id:Date.now()+1,text:"",isCorrect:!1},{id:Date.now()+2,text:"",isCorrect:!1},{id:Date.now()+3,text:"",isCorrect:!1},{id:Date.now()+4,text:"",isCorrect:!1}],answer:{text:"",image:"",audio:""}};if(x.length>0){const s=x.length-1,o=[...x];o[s].cards.push(t),C(o),m(o.flatMap(i=>i.cards))}else m([...u,t]);Ie()},Oe=()=>{C([...x,{noteSegment:"",cards:[]}])},Ie=()=>{setTimeout(()=>{G.current&&G.current.scrollTo({top:G.current.scrollHeight,behavior:"smooth"})},100)},ze=(t,s,o=null)=>{const i=parseInt(s)-1;if(o!==null){const a=[...x],r=a[o].cards;if(isNaN(i)||i<0||i>=r.length||i===t)return;const[y]=r.splice(t,1);r.splice(i,0,y),C(a),m(a.flatMap(v=>v.cards))}else{if(isNaN(i)||i<0||i>=u.length||i===t)return;const a=[...u],[r]=a.splice(t,1);a.splice(i,0,r),m(a)}},Ue=(t,s,o,i)=>{m(u.map(a=>a.id!==t?a:o==="isCorrect"?{...a,options:a.options.map(r=>({...r,isCorrect:r.id===s}))}:{...a,options:a.options.map(r=>r.id===s?{...r,[o]:i}:r)}))},Be=t=>{u.length>1&&m(u.filter(s=>s.id!==t))},_e=(t,s,o)=>{m(u.map(i=>i.id===t?{...i,[s]:o}:i))},le=(t,s,o="image")=>{const i=t.target.files[0];if(!i)return;const a=new FileReader;a.onloadend=()=>{const r=a.result;if(!Ge(r,o==="image"?["image/"]:["audio/"])){c(`Invalid ${o} file. Only ${o} files are allowed.`);return}s(r)},a.readAsDataURL(i)},Re=async(t,s)=>{J({id:t,field:s}),U(0);try{const o=await navigator.mediaDevices.getUserMedia({audio:!0}),i=new MediaRecorder(o),a=[];i.ondataavailable=r=>a.push(r.data),i.onstop=()=>{const r=new Blob(a,{type:"audio/webm"}),y=new FileReader;y.onloadend=()=>{m(v=>v.map(S=>S.id===t?{...S,[s]:{...S[s],audio:y.result}}:S))},y.readAsDataURL(r),o.getTracks().forEach(v=>v.stop()),clearInterval(se.current),U(0)},i.start(),oe(i),se.current=setInterval(()=>U(r=>r+1),1e3)}catch{c("Could not access microphone."),J(null),U(0)}},De=()=>{B&&(B.stop(),oe(null),J(null))},Te=()=>{B&&(B.onstop=()=>{clearInterval(se.current),U(0),oe(null),J(null)},B.stop())},qe=async()=>{var o;if(!w.trim())return c("Please enter a title");const t=x.length>0?x.flatMap(i=>i.cards):u;for(let i=0;i<t.length;i++){const a=t[i],r=a.question.text.trim()||a.question.image||a.question.audio,y=a.answer.text.trim()||a.answer.image||a.answer.audio;if(a.type==="mcq"){const v=(o=a.options)==null?void 0:o.some(S=>S.isCorrect);if(!r)return c(`Question is required for MCQ ${i+1}`);if(!v)return c(`Please select a correct answer for MCQ ${i+1}`)}else{if(!r)return c(`Question is required for card ${i+1}`);if(!y)return c(`Answer is required for card ${i+1}`)}}const s={id:(n==null?void 0:n.id)||Date.now().toString(),title:w,titleImage:D,label:N,standard:de,syllabus:xe,medium:he,subject:ge,importantNote:L,cards:t,sections:x,owner:l.email,avgRating:(n==null?void 0:n.avgRating)||null,lastReviewed:(n==null?void 0:n.lastReviewed)||null,cost:parseInt(fe)||0};try{Se(!0);let i;if(O){const{savePublicLesson:r}=await Je(()=>import("./publicDrive-7deb5011.js"),["assets/publicDrive-7deb5011.js","assets/index-9a3e1dd9.js","assets/index-12fad48b.css"]);i=await r(s)}else i=await re.saveStack(s);const a=i.driveFileId||i.id;f({...i,driveFileId:a},!0,O)}catch(i){Se(!1),i.message==="REAUTH_NEEDED"?et("consent"):(console.error("Save failed:",i),i.code==="storage/unknown"||i.message.includes("storage/unknown")?c('Cloud upload failed (likely CORS). Please use the "Download" button to save locally.'):c(`Failed to save stack: ${i.message}`))}},Qe=async()=>{if(!w)return c("Please save the stack first");const t={id:(n==null?void 0:n.id)||Date.now().toString(),title:w,titleImage:D,label:N,cards:u,createdAt:(n==null?void 0:n.createdAt)||new Date().toISOString()};try{await ot(t),c("Stack downloaded successfully!")}catch{c("Failed to download stack.")}},Ve=async t=>{const s=t.target.files[0];if(s)try{const o=await st(s);H(o.title),T(o.titleImage||""),q(o.label||"No label"),d(o.importantNote||""),pe(o.standard||""),ue(o.syllabus||""),me(o.medium||""),ye(o.subject||""),be(o.cost||0),m(o.cards),o.sections&&C(o.sections),c("Stack imported successfully! Review and save.")}catch(o){c(o.message||"Failed to import stack.")}},Ae=()=>{if(I.size===0)return c("Please select at least one card to split.");if(I.size===u.length)return c("Cannot split all cards.");g(`Split ${I.size} card(s) into a new stack?`,async()=>{const t=u.filter(i=>I.has(i.id)),s=u.filter(i=>!I.has(i.id)),o={id:Date.now().toString(),title:`${w} (Split)`,titleImage:D,label:N,cards:t,owner:l.email};try{const i=await re.saveStack(o);f({...i,driveFileId:i.driveFileId||i.id},!1),m(s),X(new Set),ie(!1),c("Stack split successfully!"),await qe()}catch{c("Failed to split stack.")}})},Ke=async()=>{if(!Z)return c("Please select a stack to merge with.");const t=j==null?void 0:j.find(s=>s.id===Z);if(!t)return c("Target stack not found.");g(`Merge "${w}" into "${t.title}"?`,async()=>{try{const s={...t,cards:[...t.cards,...u]};await re.saveStack(s),n!=null&&n.driveFileId&&await tt(l.token,n.driveFileId),c("Stacks merged successfully!"),E()}catch{c("Failed to merge stacks.")}})},Me=t=>{X(s=>{const o=new Set(s);return o.has(t)?o.delete(t):o.add(t),o})};return e.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,right:0,bottom:0,left:0,backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)",background:"rgba(255,255,255,0.01)",zIndex:2e3,display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsxs("div",{ref:ke,className:"modal-content neo-flat",style:{width:"100%",maxWidth:"600px",height:window.innerWidth<768?"100%":"90vh",maxHeight:"100%",padding:0,display:"flex",flexDirection:"column",position:"relative",overflow:"hidden",borderRadius:window.innerWidth<768?0:"24px"},children:[e.jsxs("div",{style:{padding:"1.5rem 2rem",borderBottom:"1px solid var(--shadow-dark)",display:"flex",justifyContent:"space-between",alignItems:"center",background:"var(--bg-color)",zIndex:10},children:[e.jsx("h2",{style:{fontSize:"1.5rem",margin:0},children:n?"Edit Stack":"New Flashcard Stack"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[n&&e.jsx("button",{className:"neo-button icon-btn",title:"Download Stack",onClick:Qe,children:e.jsx(nt,{size:18})}),n&&e.jsx("button",{className:"neo-button icon-btn",title:"Duplicate",onClick:()=>k(n),children:e.jsx(lt,{size:18})}),e.jsx(Xe,{onClick:E,size:18})]})]}),e.jsxs("div",{ref:G,style:{padding:"2rem",flex:1,overflowY:"auto",display:"flex",flexDirection:"column",gap:"1.5rem"},children:[e.jsx("div",{style:{display:"flex",gap:"1.5rem",alignItems:"flex-start"},children:e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"0.8rem"},children:[e.jsx("label",{style:{fontWeight:"600",opacity:.7},children:"Title & Cover Image"}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsxs("div",{style:{position:"relative",flex:1},children:[e.jsx("input",{id:"modal-title-input",className:"neo-input",placeholder:"Stack Title ",value:w,onChange:t=>H(P(t.target.value)),style:{paddingRight:"30px"}}),!w&&e.jsx("span",{style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",color:"red",pointerEvents:"none"},children:"*"})]}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("label",{className:"neo-button icon-btn",style:{cursor:"pointer",flexShrink:0,color:D?"var(--accent-color)":"currentColor"},children:[e.jsx(ce,{size:18}),e.jsx("input",{type:"file",hidden:!0,accept:"image/*",onChange:t=>le(t,T)})]}),D&&e.jsx("button",{className:"neo-button icon-btn",style:{flexShrink:0},onClick:()=>T(""),children:e.jsx(Q,{size:16,color:"var(--error-color)"})})]})]}),e.jsx(W,{label:"Label",value:N,options:[{label:"No label",value:"No label"},...A.filter(t=>t!=="No label").map(t=>({label:t,value:t}))],onChange:q,placeholder:"Select label...",children:e.jsxs("div",{style:{display:"flex",gap:"8px",padding:"8px",borderBottom:"1px solid var(--shadow-dark)",marginBottom:"4px"},children:[e.jsx("input",{className:"neo-input",placeholder:"Create new label...",value:b,onChange:t=>M(P(t.target.value)),onKeyPress:t=>{t.key==="Enter"&&b.trim()&&(q(b.trim()),M(""))},style:{flex:1,fontSize:"0.85rem",padding:"8px 12px",height:"36px"}}),e.jsx("button",{className:"neo-button",style:{padding:"8px 12px",fontSize:"0.85rem",height:"36px"},onClick:()=>{b.trim()&&(q(b.trim()),M(""))},children:e.jsx(_,{size:14})})]})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.8rem",marginTop:"0.5rem"},children:[e.jsx("label",{style:{fontWeight:"600",opacity:.7},children:"Important Note (Optional)"}),e.jsx(te,{placeholder:"Add an important note...",value:L,onChange:t=>d(P(t.target.value))})]})]})}),(l==null?void 0:l.email)===ae&&e.jsxs("div",{className:"neo-inset",style:{padding:"1.5rem",display:"flex",flexDirection:"column",gap:"1.25rem",borderRadius:"16px"},children:[e.jsx("h3",{style:{fontSize:"0.9rem",fontWeight:"bold",opacity:.6},children:"COMMUNITY METADATA"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1.25rem"},children:[e.jsx(W,{label:"Standard",value:de,options:["V","VI","VII","VIII","IX","X"].map(t=>({label:`Standard ${t}`,value:t})),onChange:pe,placeholder:"Select Standard"}),e.jsx(W,{label:"Syllabus",value:xe,options:["NCERT","Kerala"].map(t=>({label:t,value:t})),onChange:ue,placeholder:"Select Syllabus"}),e.jsx(W,{label:"Medium",value:he,options:["Malayalam","English"].map(t=>({label:t,value:t})),onChange:me,placeholder:"Select Medium"}),e.jsx(W,{label:"Subject",value:ge,options:["Maths","Social Science","Science","English","Malayalam","Hindi"].map(t=>({label:t,value:t})),onChange:ye,placeholder:"Select Subject"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.8rem"},children:[e.jsx("label",{style:{fontSize:"0.7rem",fontWeight:"700",color:"#94a3b8",textTransform:"uppercase"},children:"Cost (Coins)"}),e.jsx("input",{type:"number",className:"neo-input",value:fe,onChange:t=>be(t.target.value),placeholder:"0 for free",style:{padding:"10px 12px"}})]})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"10px",marginTop:"1rem",cursor:"pointer",padding:"0.5rem",borderRadius:"8px",background:O?"var(--accent-soft)":"transparent"},children:[e.jsx("input",{type:"checkbox",checked:O,onChange:t=>We(t.target.checked),style:{width:"18px",height:"18px"}}),e.jsx("span",{style:{fontSize:"0.9rem",fontWeight:"600",color:O?"var(--accent-color)":"inherit"},children:"Publish to Community Pool"})]})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"2rem"},children:x&&x.length>0?x.map((t,s)=>e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",padding:"1rem",borderRadius:"12px",border:"1px solid var(--shadow-dark)"},children:[e.jsxs("div",{className:"neo-flat",style:{padding:"1rem",borderLeft:"4px solid var(--accent-color)",borderRadius:"8px"},children:[e.jsx("label",{style:{fontSize:"0.7rem",fontWeight:"bold",opacity:.5,textTransform:"uppercase",display:"block",marginBottom:"4px"},children:"Section Note"}),e.jsx(te,{value:t.noteSegment,onChange:o=>{const i=[...x];i[s].noteSegment=o.target.value,C(i)},placeholder:"Enter section note...",style:{minHeight:"40px",background:"transparent",boxShadow:"none"}})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:t.cards.map((o,i)=>e.jsx(Fe,{card:o,index:i,totalCards:t.cards.length,onUpdate:(a,r)=>{const y=[...x];y[s].cards[i]={...o,[a]:r},C(y),m(y.flatMap(v=>v.cards))},onRemove:()=>{const a=[...x];a[s].cards.splice(i,1),C(a),m(a.flatMap(r=>r.cards))},onMove:a=>ze(i,a,s),recording:Ce,startRecording:Re,stopRecording:De,cancelRecording:Te,recordingTime:Ne,handleFileUpload:le,handleOptionChange:(a,r,y)=>{const v=[...x],S=v[s].cards[i];r==="isCorrect"?S.options=S.options.map(z=>({...z,isCorrect:z.id===a})):S.options=S.options.map(z=>z.id===a?{...z,[r]:y}:z),C(v),m(v.flatMap(z=>z.cards))},setViewingImage:ne,showSplitUI:F,selectedCards:I,toggleCardSelection:Me},o.id))}),e.jsxs("button",{className:"neo-button",style:{alignSelf:"center",fontSize:"0.8rem",opacity:.6},onClick:()=>{const o=[...x];o.splice(s+1,0,{noteSegment:"",cards:[]}),C(o)},children:[e.jsx(_,{size:14})," Insert Section Here"]})]},s)):u.map((t,s)=>e.jsx(Fe,{card:t,index:s,totalCards:u.length,onUpdate:(o,i)=>_e(t.id,o,i),onRemove:()=>Be(t.id),onMove:o=>ze(s,o),recording:Ce,startRecording:Re,stopRecording:De,cancelRecording:Te,recordingTime:Ne,handleFileUpload:le,handleOptionChange:(o,i,a)=>Ue(t.id,o,i,a),setViewingImage:ne,showSplitUI:F,selectedCards:I,toggleCardSelection:Me},t.id))}),e.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[e.jsxs("button",{className:"neo-button neo-glow-blue",style:{flex:1,justifyContent:"center",background:"var(--accent-soft)",color:"var(--accent-color)"},onClick:He,children:[e.jsx(_,{size:18})," Add Card"]}),e.jsxs("button",{className:"neo-button neo-glow-blue",style:{flex:1,justifyContent:"center",background:"var(--accent-soft)",color:"var(--accent-color)"},onClick:Le,children:[e.jsx(_,{size:18})," Add MCQ"]}),e.jsxs("button",{className:"neo-button neo-glow-blue",style:{flex:1,justifyContent:"center",background:"var(--bg-color)",color:"var(--accent-color)"},onClick:Oe,children:[e.jsx(_,{size:18})," Add Section"]})]}),n&&u.length>1&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[e.jsxs("button",{className:`neo-button ${F?"neo-inset":""}`,style:{flex:1,justifyContent:"center",fontSize:"0.9rem"},onClick:()=>{ie(!F),we(!1),X(new Set)},children:[e.jsx(ct,{size:16})," ",F?"Cancel Split":"Split Stack"]}),j&&j.filter(t=>t.id!==(n==null?void 0:n.id)).length>0&&e.jsxs("button",{className:`neo-button ${Y?"neo-inset":""}`,style:{flex:1,justifyContent:"center",fontSize:"0.9rem"},onClick:()=>{we(!Y),ie(!1),X(new Set)},children:[e.jsx(at,{size:16})," ",Y?"Cancel Merge":"Merge Stack"]})]}),F&&e.jsxs("div",{className:"neo-inset",style:{padding:"1rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("p",{style:{fontSize:"0.9rem",opacity:.7},children:"Select cards to move to a new stack:"}),e.jsxs("button",{className:"neo-button neo-glow-blue",style:{background:"var(--accent-color)",color:"white",border:"none",justifyContent:"center"},onClick:Ae,children:["Create New Stack with ",I.size," Selected Card(s)"]})]}),Y&&e.jsxs("div",{className:"neo-inset",style:{padding:"1rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("p",{style:{fontSize:"0.9rem",opacity:.7},children:"Select stack to merge into:"}),e.jsx(W,{value:Z,options:j==null?void 0:j.filter(t=>t.id!==(n==null?void 0:n.id)).map(t=>{var s;return{label:`${t.title} (${((s=t.cards)==null?void 0:s.length)||0} cards)`,value:t.id}}),onChange:Pe,placeholder:"-- Select Stack --",displayValue:t=>{var s;return(s=j.find(o=>o.id===t))==null?void 0:s.title}}),e.jsx("button",{className:"neo-button neo-glow-blue",style:{background:"var(--accent-color)",color:"white",border:"none",justifyContent:"center"},onClick:Ke,disabled:!Z,children:"Merge Into Selected Stack"})]})]})]}),e.jsxs("div",{style:{padding:"1.5rem",borderTop:"1px solid var(--shadow-dark)",display:"flex",flexDirection:"column",gap:"1rem",background:"var(--bg-color)",zIndex:10},children:[!n&&(l==null?void 0:l.email)===ae&&e.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[e.jsx("input",{ref:je,type:"file",hidden:!0,accept:".zip",onChange:Ve}),e.jsxs("button",{className:"neo-button neo-glow-blue",style:{flex:1,justifyContent:"center",background:"var(--accent-soft)",color:"var(--accent-color)"},onClick:()=>{var t;return(t=je.current)==null?void 0:t.click()},children:[e.jsx(dt,{size:18})," Upload from Device"]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem",flexWrap:"wrap"},children:[n&&e.jsxs("button",{className:"neo-button neo-glow-red",style:{flex:"1 1 8.75rem",justifyContent:"center",color:"var(--error-color)",padding:"0.8rem"},onClick:()=>g(`Delete "${n.title}"?`,()=>R(n)),children:[e.jsx(Q,{size:18})," Delete Stack"]}),e.jsx("button",{className:"neo-button",style:{flex:"1 1 6.25rem",justifyContent:"center",padding:"0.8rem"},onClick:E,children:"Cancel"}),e.jsx("button",{className:`neo-button ${$?"neo-inset":""}`,style:{flex:"2 1 12.5rem",justifyContent:"center",background:$?"var(--bg-color)":"var(--accent-color)",color:$?"var(--accent-color)":"white",border:"none",padding:"0.8rem",cursor:$?"not-allowed":"pointer",opacity:$?.8:1},onClick:qe,disabled:$,children:$?e.jsxs(e.Fragment,{children:[e.jsx(Ye,{size:18,className:"spin",style:{marginRight:"8px"}})," Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(rt,{size:18,style:{marginRight:"8px"}})," ",n?"Save Changes":"Create Stack"]})})]})]}),e.jsx(Ze,{children:ve&&e.jsx(it,{imageUrl:ve,onClose:()=>ne(null)})})]})})};export{mt as default};
